<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>初学单片机2 | cjl's Blog</title><meta name="description" content="中断系统概念:CPU在处理某一事件A时，发生了另一事件B请求CPU迅速去处理（中断发生）；CPU暂时中断当前的工作，转去处理事件B（中断响应和中断服务）;待CPU将事件B处理完毕后，再回到原来事件A被中断的地方继续处理事件A（中断返回），这一过程称为中断 。中断系统结构：通过学习我们了解到中断系统的五个中断源，如下表。中断源符号名称中断引起的原因中断号&#x2F;INT0外部中断0P3.2引脚低电平或下降沿"><meta name="keywords" content="自学"><meta name="author" content="Dragon6879"><meta name="copyright" content="Dragon6879"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="canonical" href="http://cjl520.top/%E5%88%9D%E5%AD%A6%E5%8D%95%E7%89%87%E6%9C%BA2/"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//fonts.googleapis.com" crossorigin="crossorigin"><link rel="preconnect" href="//busuanzi.ibruce.info"><meta property="og:type" content="article"><meta property="og:title" content="初学单片机2"><meta property="og:url" content="http://cjl520.top/%E5%88%9D%E5%AD%A6%E5%8D%95%E7%89%87%E6%9C%BA2/"><meta property="og:site_name" content="cjl's Blog"><meta property="og:description" content="中断系统概念:CPU在处理某一事件A时，发生了另一事件B请求CPU迅速去处理（中断发生）；CPU暂时中断当前的工作，转去处理事件B（中断响应和中断服务）;待CPU将事件B处理完毕后，再回到原来事件A被中断的地方继续处理事件A（中断返回），这一过程称为中断 。中断系统结构：通过学习我们了解到中断系统的五个中断源，如下表。中断源符号名称中断引起的原因中断号&#x2F;INT0外部中断0P3.2引脚低电平或下降沿"><meta property="og:image" content="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg"><meta property="article:published_time" content="2020-05-14T03:44:03.000Z"><meta property="article:modified_time" content="2020-07-18T16:10:00.710Z"><meta name="twitter:card" content="summary"><script>var activateDarkMode = function () {
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#000')
  }
}
var activateLightMode = function () {
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#fff')
  }
}

var getCookies = function (name) {
  const value = `; ${document.cookie}`
  const parts = value.split(`; ${name}=`)
  if (parts.length === 2) return parts.pop().split(';').shift()
}

var autoChangeMode = 'false'
var t = getCookies('theme')
if (autoChangeMode === '1') {
  var isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
  var isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
  var isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined) {
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport) {
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour <= 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
    }
    window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
      if (Cookies.get('theme') === undefined) {
        e.matches ? activateDarkMode() : activateLightMode()
      }
    })
  } else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else if (autoChangeMode === '2') {
  now = new Date()
  hour = now.getHours()
  isNight = hour <= 6 || hour >= 18
  if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else {
  if (t === 'dark') activateDarkMode()
  else if (t === 'light') activateLightMode()
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap"><script>var GLOBAL_CONFIG={root:"/",hexoversion:"4.2.0",algolia:void 0,localSearch:{path:"search.xml",languages:{hits_empty:"找不到您查询的内容：${query}"}},translate:void 0,noticeOutdate:void 0,copy:{success:"复制成功",error:"复制错误",noSupport:"浏览器不支持"},bookmark:{message_prev:"按",message_next:"键将本页加入书签"},runtime_unit:"天",runtime:!1,copyright:void 0,ClickShowText:{text:"I,LOVE,YOU",fontSize:"15px"},medium_zoom:!1,fancybox:!0,Snackbar:void 0,justifiedGallery:{js:"https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js",css:"https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css"},baiduPush:!1,highlightCopy:!0,highlightLang:!0,isPhotoFigcaption:!1,islazyload:!0,isanchor:!1}</script><script id="config_change">var GLOBAL_CONFIG_SITE={isPost:!0,isHome:!1,isHighlightShrink:!1,isSidebar:!0,postUpdate:"2020-07-19 00:10:00"}</script><noscript><style>#nav{opacity:1}.justified-gallery img{opacity:1}</style></noscript><meta name="generator" content="Hexo 4.2.0"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" data-lazy-src="/img/touxiang.jpg" onerror='onerror=null,src="/img/friend_404.gif"' alt="avatar"></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">12</div></a></div></div><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">5</div></a></div></div><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">4</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div id="body-wrap"><div id="web_bg" data-type="photo"></div><div id="sidebar"><i class="fas fa-arrow-right on" id="toggle-sidebar"></i><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#中断系统"><span class="toc-number">1.</span> <span class="toc-text">中断系统</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#定时器中断"><span class="toc-number">2.</span> <span class="toc-text">定时器中断</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#串口通信"><span class="toc-number">3.</span> <span class="toc-text">串口通信</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#IIC总线工作原理"><span class="toc-number">4.</span> <span class="toc-text">IIC总线工作原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DS18B20温度传感器"><span class="toc-number">5.</span> <span class="toc-text">DS18B20温度传感器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#液晶1602显示"><span class="toc-number">6.</span> <span class="toc-text">液晶1602显示</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#红外原理"><span class="toc-number">7.</span> <span class="toc-text">红外原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DS1302时钟"><span class="toc-number">8.</span> <span class="toc-text">DS1302时钟</span></a></li></ol></div></div></div><header class="post-bg" id="page-header" style="background-image:url(https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg)"><nav id="nav"><span class="pull-left" id="blog_name"><a class="blog_title" id="site-name" href="/">cjl's Blog</a></span><span class="pull-right menus"><div id="search_button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><div id="post-title"><div class="posttitle">初学单片机2</div></div><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2020-05-14T03:44:03.000Z" title="发表于 2020-05-14 11:44:03">2020-05-14</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2020-07-18T16:10:00.710Z" title="更新于 2020-07-19 00:10:00">2020-07-19</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%8D%95%E7%89%87%E6%9C%BA/">单片机</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/%E5%88%9D%E5%AD%A6%E5%8D%95%E7%89%87%E6%9C%BA2/#post-comment" itemprop="discussionUrl"><span class="valine-comment-count comment-count" data-xid="/%E5%88%9D%E5%AD%A6%E5%8D%95%E7%89%87%E6%9C%BA2/" itemprop="commentCount"></span></a></span></div></div></div></header><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h2 id="中断系统"><a href="#中断系统" class="headerlink" title="中断系统"></a>中断系统</h2><ol><li>概念:CPU在处理某一事件A时，发生了另一事件B请求CPU迅速去处理（中断发生）；<a id="more"></a>CPU暂时中断当前的工作，转去处理事件B（中断响应和中断服务）;待CPU将事件B处理完毕后，再回到原来事件A被中断的地方继续处理事件A（中断返回），这一过程称为中断 。</li><li>中断系统结构：<img src="/img/loading.gif" data-lazy-src="/%E5%88%9D%E5%AD%A6%E5%8D%95%E7%89%87%E6%9C%BA2/1.png" title="图示"><br><br>通过学习我们了解到中断系统的五个中断源，如下表。<table><tr><td>中断源符号</td><td>名称</td><td>中断引起的原因</td><td>中断号</td></tr><tr><td>/INT0</td><td>外部中断0</td><td>P3.2引脚低电平或下降沿信号</td><td>0</td></tr><tr><td>T0</td><td>定时器0中断</td><td>定时/计数器0计数回0溢出</td><td>1</td></tr><tr><td>/INT1</td><td>外部中断1</td><td>P3.3引脚低电平或下降沿信号</td><td>2</td></tr><tr><td>T1</td><td>定时器1中断</td><td>定时/计数器1计数回0溢出</td><td>3</td></tr><tr><td>TI/RI</td><td>串行口中断</td><td>串行通信完成一帧数据发送或接收引起中断</td><td>4</td></tr></table></li></ol><blockquote><p>表格中五个中断源的优先级也是自上而下，引发一个中断需要有必要的条件。（可以对照结构图推断）。<br></p></blockquote><ol><li>IT0 外部中断0触发方式控制位。<pre><code>当IT0=0时，为电平触发方式。
当IT0=1时，为边沿触发方式（下降沿有效）。</code></pre></li><li>EX0=1; 外部中断0中断请求</li><li>EA=1;总中断开关</li></ol><p>举个程序例子：实现用K3按键中断原本LED灯亮，并</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"reg52.h"</span></span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">char</span> u8;  <span class="comment">//0-255</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">int</span> u16;  <span class="comment">//0-65535</span></span><br><span class="line"></span><br><span class="line">sbit led=P2^<span class="number">0</span>;</span><br><span class="line">sbit k3=P3^<span class="number">2</span>;         <span class="comment">//P3.2引脚，对应外部中断INT0</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">delay</span><span class="params">(u16 i)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">       <span class="keyword">while</span>(i--);  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Int0Init</span><span class="params">()</span>        <span class="comment">//这个函数内容可以写在主函数里面</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        IT0=<span class="number">1</span>;        <span class="comment">//触发方式1，下降沿有效</span></span><br><span class="line">        EX0=<span class="number">1</span>;        <span class="comment">//打开外部中断</span></span><br><span class="line">        EA=<span class="number">1</span>;         <span class="comment">//打开总中断开关</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">       Int0Init();</span><br><span class="line">       <span class="keyword">while</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Int0</span><span class="params">()</span> interrupt 0         <span class="comment">//中断函数，0为中断号（见表格）</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">       <span class="built_in">delay</span>(<span class="number">1000</span>);</span><br><span class="line">       <span class="keyword">if</span>(k3==<span class="number">0</span>)        <span class="comment">//当按下按键，翻转灯状态</span></span><br><span class="line">       &#123;</span><br><span class="line">       led=~led;</span><br><span class="line">       &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>TCON的中断请求标志：</p><table><tr><td>位</td><td>7</td><td>6</td><td>5</td><td>4</td><td>3</td><td>2</td><td>1</td><td>0</td></tr><tr><td>字节地址</td><td>TF1</td><td>TR1</td><td>TF0</td><td>TR0</td><td>IE1</td><td>IT1</td><td>IE0</td><td>IT0</td></tr></table><ol><li>IT0（TCON.0），外部中断0触发方式控制位。<br><pre><code>当IT0=0时，为电平触发方式。
当IT0=1时，为边沿触发方式（下降沿有效）。</code></pre></li><li>IE0（TCON.1），外部中断0中断请求标志位。</li><li>IT1（TCON.2），外部中断1触发方式控制位。</li><li>IE1（TCON.3），外部中断1中断请求标志位。</li><li>TF0（TCON.5），定时/计数器T0溢出中断请求标志位。</li><li>TF1（TCON.7），定时/计数器T1溢出中断请求标志位。</li><li>TR1 (TCON.6) ，T1运行控制位。TR1=1时，T1工作。TR1=0时，T1停止工作。</li><li>TR0 (TCON.4) ，同上T0；</li></ol><h2 id="定时器中断"><a href="#定时器中断" class="headerlink" title="定时器中断"></a>定时器中断</h2><p>代码：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"reg52.h"</span></span></span><br><span class="line"></span><br><span class="line"> <span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">char</span> u8;</span><br><span class="line"> <span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">int</span> u16;</span><br><span class="line"></span><br><span class="line">sbit led=P2^<span class="number">0</span>;        <span class="comment">//D1</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Timer0Init</span><span class="params">()</span>        <span class="comment">//可以直接放到主函数中</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">       TMOD|=<span class="number">0x01</span>;       <span class="comment">//0000 0001         第四位T0运转，高四位置零不运作。</span></span><br><span class="line">       TH0=<span class="number">0xFC</span>;         <span class="comment">//1111 1100         设置初始值</span></span><br><span class="line">       TL0=<span class="number">0x18</span>;         <span class="comment">//0001 1000        64536=FC18H</span></span><br><span class="line">       ET0=<span class="number">1</span>;        <span class="comment">//打开外部中断0</span></span><br><span class="line">       EA=<span class="number">1</span>;         <span class="comment">//总中断开关</span></span><br><span class="line">       TR0=<span class="number">1</span>;       <span class="comment">// T0运行控制位。TR0=1时，T0工作。</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"> Timer0Init();</span><br><span class="line"> <span class="keyword">while</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Time0</span><span class="params">()</span> interrupt 1</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">       <span class="keyword">static</span> u16 i;  </span><br><span class="line">       TH0=<span class="number">0xFC</span>;        <span class="comment">//1111 1100</span></span><br><span class="line">       TL0=<span class="number">0x18</span>;        <span class="comment">//0001 1000</span></span><br><span class="line">       i++;       <span class="comment">//每累加到1000，也就是1s，执行函数</span></span><br><span class="line">       <span class="keyword">if</span>(i==<span class="number">1000</span>)         <span class="comment">//1s</span></span><br><span class="line">       &#123;</span><br><span class="line">         i=<span class="number">0</span>;        <span class="comment">//清零</span></span><br><span class="line">         led=~led;        <span class="comment">//小灯翻转1s</span></span><br><span class="line">       &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>定时器中断的步骤如下：</p></blockquote><ol><li>对TMOD赋值，以确定T0和T1的工作方式。</li><li>计算初值,并将其写入TH0、TL0或TH1、TL1。</li><li>中断方式时，则对EA赋值，开放定时器中断ET0。</li><li>使TR0或TR1置位，启动定时/计数器定时或计数。</li></ol><p>TMOD定时计数寄存器：</p><table><tr><td>7</td><td>6</td><td>5</td><td>4</td><td>3</td><td>2</td><td>1</td><td>0</td></tr><tr><td>GATE</td><td>C/T</td><td>M1</td><td>M0</td><td>GATE</td><td>C/T</td><td>M1</td><td>M0</td></tr></table><p>高四位控制T1，低四位控制T0.</p><ol><li>GATE——门控制。<br>●GATE=1时，由外部中断引脚INT0、INT1来启动定时器T0、T1.<br>当INT0引脚为高电平时TR0置位，启动定时器T0;<br>当INT1引脚为高电平时TR1置位，启动定时器T1。<br>●GATE=0时，仅由TR0,TR1置位分别启动定时器T0、T1。</li><li>C/T=0时，定时模式；C/T=1时，计数模式。</li><li>M1M0 四种模式。<br></li></ol><p>0 0 方式0 13位计数器</p><p>0 1 方式1 16位计数器</p><p>1 0 方式2 自动重装8位计数器</p><p>1 1 方式3 T0分为2个8位独立计数器，T1此时停止计数。</p><hr><h2 id="串口通信"><a href="#串口通信" class="headerlink" title="串口通信"></a>串口通信</h2><p>代码如下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"reg52.h"</span>       <span class="comment">//此文件中定义了单片机的一些特殊功能寄存器</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">int</span> u16;        <span class="comment">//对数据类型进行声明定义</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">char</span> u8;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">UsartInit</span><span class="params">()</span>         <span class="comment">//可以直接写在主程序中</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">         SCON=<span class="number">0X50</span>;         <span class="comment">//SCON设置为工作方式1</span></span><br><span class="line">         TMOD=<span class="number">0X20</span>;         <span class="comment">//设置计数器工作方式2       0010 0000</span></span><br><span class="line">         PCON=<span class="number">0X80</span>;         <span class="comment">//波特率加倍1000 0000</span></span><br><span class="line">         TH1=<span class="number">0XF3</span>;       <span class="comment">//计数器初始值设置，注意波特率是4800的</span></span><br><span class="line">         TL1=<span class="number">0XF3</span>;</span><br><span class="line">         ES=<span class="number">1</span>;         <span class="comment">//打开接收中断</span></span><br><span class="line">         EA=<span class="number">1</span>;         <span class="comment">//打开总中断</span></span><br><span class="line">         TR1=<span class="number">1</span>;         <span class="comment">//打开T1计数器</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;         </span><br><span class="line">         UsartInit();  <span class="comment">//         串口初始化</span></span><br><span class="line">         <span class="keyword">while</span>(<span class="number">1</span>);         </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Usart</span><span class="params">()</span> interrupt 4         </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">         u8 receiveData;</span><br><span class="line">         <span class="keyword">if</span>(RI==<span class="number">1</span>)       <span class="comment">//是否接受到数据</span></span><br><span class="line">         receiveData=SBUF;        <span class="comment">//出去接收到的数据</span></span><br><span class="line">         RI = <span class="number">0</span>;         <span class="comment">//清除接收中断标志位</span></span><br><span class="line">         SBUF=receiveData;        <span class="comment">//将接收到的数据放入到发送寄存器</span></span><br><span class="line">         <span class="keyword">while</span>(!TI);       <span class="comment">//等待发送数据完成</span></span><br><span class="line">         TI=<span class="number">0</span>;       <span class="comment">//清除发送完成标志位</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>SCON串行口控制寄存器</p><table><tr><td>7</td><td>6</td><td>5</td><td>4</td><td>3</td><td>2</td><td>1</td><td>0</td></tr><tr><td>SM0</td><td>SM1</td><td>SM2</td><td>REN</td><td>TB8</td><td>RB8</td><td>TI</td><td>RI</td></tr></table><p>复制点概念：</p><ol><li>SM0和SM1为工作方式选择位,如图.<br><img src="/img/loading.gif" data-lazy-src="/%E5%88%9D%E5%AD%A6%E5%8D%95%E7%89%87%E6%9C%BA2/3.png" title="图示"><br></li><li>SM2，多机通信控制位，主要用于方式2和方式3。当接收机的SM2=1时可以利用收到的RB8来控制是否激活RI。</li><li>REN，允许串行接收位。由软件置REN=1，则启动串行口接收数据；若软件置REN=0，则禁止接收。</li><li>TI，发送中断标志位。</li><li>RI，接收中断标志位。</li></ol><p>PCON中的SMOD与串行口工作有关：波特率倍增位。当SMOD=1时，波特率提高一倍。复位时，SMOD=0。<br>如何设置串口：</p><ol><li>确定T1的工作方式（编程TMOD寄存器）；</li><li>计算T1的初值，装载TH1、TL1；</li><li>启动T1（编程TCON中的TR1位）；</li><li>确定串行口控制（编程SCON寄存器）；</li><li>中断申请</li></ol><blockquote><p>关于SBUF，给出链接资料<a href="https://baike.sogou.com/v69375645.htm?fromTitle=SBUF" target="_blank" rel="noopener">SBUF</a>。</p></blockquote><hr><h2 id="IIC总线工作原理"><a href="#IIC总线工作原理" class="headerlink" title="IIC总线工作原理"></a>IIC总线工作原理</h2><p><a href="https://baike.sogou.com/v7668256.htm?fromTitle=I2C%E6%80%BB%E7%BA%BF" target="_blank" rel="noopener">!I2C</a>（Inter－Integrated Circuit）总线是由PHILIPS公司开发的两线式串行总线，用于连接微控制器及其外围设备。<br></p><ol><li>I2C头文件代码代码如下：<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> __I2C_H_</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __I2C_H_</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;reg52.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">sbit SCL=P2^<span class="number">1</span>;</span><br><span class="line">sbit SDA=P2^<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">I2cStart</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">I2cStop</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">char</span> <span class="title">I2cSendByte</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> dat)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">char</span> <span class="title">I2cReadByte</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">At24c02Write</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> addr,<span class="keyword">unsigned</span> <span class="keyword">char</span> dat)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">char</span> <span class="title">At24c02Read</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> addr)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure></li><li>I2C.c文件如下：<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">"i2c.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Delay10us</span><span class="params">()</span>       <span class="comment">//用单片机小精灵弄10us延迟函数</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">         <span class="keyword">unsigned</span> <span class="keyword">char</span> a,b;</span><br><span class="line">         <span class="keyword">for</span>(b=<span class="number">1</span>;b&gt;<span class="number">0</span>;b--)</span><br><span class="line">         <span class="keyword">for</span>(a=<span class="number">2</span>;a&gt;<span class="number">0</span>;a--);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">I2cStart</span><span class="params">()</span>        <span class="comment">//起始信号：在SCL时钟信号在高电平期间SDA信号产生一个下降沿</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">         SDA=<span class="number">1</span>;</span><br><span class="line">         Delay10us();</span><br><span class="line">         SCL=<span class="number">1</span>;</span><br><span class="line">         Delay10us();       <span class="comment">//建立时间是SDA保持时间&gt;4.7us</span></span><br><span class="line">         SDA=<span class="number">0</span>;</span><br><span class="line">         Delay10us();         <span class="comment">//保持时间是&gt;4us</span></span><br><span class="line">         SCL=<span class="number">0</span>;         </span><br><span class="line">         Delay10us();         <span class="comment">//起始之后SDA和SCL都为0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">I2cStop</span><span class="params">()</span>       <span class="comment">//终止信号：在SCL时钟信号高电平期间SDA信号产生一个上升沿</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">         SDA=<span class="number">0</span>;</span><br><span class="line">         Delay10us();</span><br><span class="line">         SCL=<span class="number">1</span>;</span><br><span class="line">         Delay10us();       <span class="comment">//建立时间大于4.7us</span></span><br><span class="line">         SDA=<span class="number">1</span>;</span><br><span class="line">         Delay10us();         <span class="comment">//结束之后保持SDA和SCL都为1；表示总线空闲</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">char</span> <span class="title">I2cSendByte</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> dat)</span><span class="comment">//发送数据</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">         <span class="keyword">unsigned</span> <span class="keyword">char</span> a=<span class="number">0</span>,b=<span class="number">0</span>;         <span class="comment">//最大255，一个机器周期为1us，最大延时255us。         </span></span><br><span class="line">         <span class="comment">//通过I2C发送一个字节。在SCL时钟信号高电平期间，保持发送信号SDA         </span></span><br><span class="line">         <span class="keyword">for</span>(a=<span class="number">0</span>;a&lt;<span class="number">8</span>;a++)         <span class="comment">//要发送8位，从最高位开始</span></span><br><span class="line">         &#123;         <span class="comment">//起始信号之后SCL=0，所以可以直接改变SDA信号</span></span><br><span class="line">         SDA=dat&gt;&gt;<span class="number">7</span>;       <span class="comment">//将发送的dat一个字节（8位）右移7位，可以把最高位提出赋值给SDA。</span></span><br><span class="line">         dat=dat&lt;&lt;<span class="number">1</span>;       <span class="comment">//将dat左移一位，把最高位挤出去了</span></span><br><span class="line">         Delay10us();</span><br><span class="line">         SCL=<span class="number">1</span>;        <span class="comment">//SCL=1；SDA保持稳定</span></span><br><span class="line">         Delay10us();       <span class="comment">//建立时间&gt;4.7us</span></span><br><span class="line">         SCL=<span class="number">0</span>;       <span class="comment">//SDA可变动</span></span><br><span class="line">         Delay10us();        <span class="comment">//时间大于4us         </span></span><br><span class="line">         &#125;</span><br><span class="line">         SDA=<span class="number">1</span>;         <span class="comment">//释放数据线</span></span><br><span class="line">         Delay10us();</span><br><span class="line">         SCL=<span class="number">1</span>;         <span class="comment">//释放时钟线</span></span><br><span class="line">         <span class="keyword">while</span>(SDA)        <span class="comment">//等待应答，也就是等待从设备把SDA拉低</span></span><br><span class="line">         &#123;</span><br><span class="line">         b++;</span><br><span class="line">         <span class="keyword">if</span>(b&gt;<span class="number">200</span>)       <span class="comment">//如果超过2000us没有应答发送失败，或者为非应答，表示接收结束</span></span><br><span class="line">         &#123;</span><br><span class="line">         SCL=<span class="number">0</span>;        <span class="comment">//拉低</span></span><br><span class="line">         Delay10us();</span><br><span class="line">         <span class="keyword">return</span> <span class="number">0</span>;         <span class="comment">//通讯失败，返回0</span></span><br><span class="line">         &#125;</span><br><span class="line">         &#125;</span><br><span class="line">         SCL=<span class="number">0</span>;        <span class="comment">//应答后，拉低SCL</span></span><br><span class="line">         Delay10us();</span><br><span class="line">         <span class="keyword">return</span> <span class="number">1</span>;       <span class="comment">//发送成功，返回1</span></span><br><span class="line">&#125;        <span class="comment">//备注：发送完一个字节SCL=0,SDA=1</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">char</span> <span class="title">I2cReadByte</span><span class="params">()</span>       <span class="comment">//读取数据</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">         <span class="keyword">unsigned</span> <span class="keyword">char</span> a=<span class="number">0</span>,dat=<span class="number">0</span>;</span><br><span class="line">         SDA=<span class="number">1</span>;        <span class="comment">//起始和发送一个字节之后SCL都是0</span></span><br><span class="line">         Delay10us();</span><br><span class="line">         <span class="keyword">for</span>(a=<span class="number">0</span>;a&lt;<span class="number">8</span>;a++)  <span class="comment">//接收8个字节</span></span><br><span class="line">         &#123;</span><br><span class="line">         SCL=<span class="number">1</span>;       <span class="comment">//拉高，SDA数据稳定</span></span><br><span class="line">         Delay10us();       <span class="comment">//dat从1-8地址位，</span></span><br><span class="line">         dat&lt;&lt;=<span class="number">1</span>;        <span class="comment">//00 01 010</span></span><br><span class="line">         dat|=SDA;       <span class="comment">//        01 11 </span></span><br><span class="line">         Delay10us();       <span class="comment">//或运算</span></span><br><span class="line">         SCL=<span class="number">0</span>;       <span class="comment">//改变</span></span><br><span class="line">         Delay10us();</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">return</span> dat;         </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">At24c02Write</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> addr,<span class="keyword">unsigned</span> <span class="keyword">char</span> dat)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">         I2cStart();</span><br><span class="line">         I2cSendByte(<span class="number">0xa0</span>);       <span class="comment">//发送写器件地址1010 0000</span></span><br><span class="line">         I2cSendByte(addr);       <span class="comment">//发送要写入内存地址</span></span><br><span class="line">         I2cSendByte(dat);        <span class="comment">//发送数据</span></span><br><span class="line">         I2cStop();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">char</span> <span class="title">At24c02Read</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> addr)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">         <span class="keyword">unsigned</span> <span class="keyword">char</span> num;</span><br><span class="line">         I2cStart();</span><br><span class="line">         I2cSendByte(<span class="number">0xa0</span>); <span class="comment">//发送写器件地址</span></span><br><span class="line">         I2cSendByte(addr); <span class="comment">//发送要读取的地址</span></span><br><span class="line">         I2cStart();</span><br><span class="line">         I2cSendByte(<span class="number">0xa1</span>); <span class="comment">//发送读器件地址</span></span><br><span class="line">         num=I2cReadByte(); <span class="comment">//读取数据</span></span><br><span class="line">         I2cStop();</span><br><span class="line">         <span class="keyword">return</span> num;         </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>main.c<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**************************************************************************************</span></span><br><span class="line"><span class="comment">实验现象：下载程序后数码管后4位显示0，按K1保存显示的数据，按K2读取上次保存的数据，</span></span><br><span class="line"><span class="comment">        按K3显示数据加一，按K4显示数据清零。最大能写入的数据是255</span></span><br><span class="line"><span class="comment">        </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        </span></span><br><span class="line"><span class="comment">         </span></span><br><span class="line"><span class="comment">注意事项：        </span></span><br><span class="line"><span class="comment">***************************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"reg52.h"</span>       <span class="comment">//此文件中定义了单片机的一些特殊功能寄存器</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"i2c.h"</span>         </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">int</span> u16;        <span class="comment">//对数据类型进行声明定义</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">char</span> u8;</span><br><span class="line"></span><br><span class="line">sbit LSA=P2^<span class="number">2</span>;</span><br><span class="line">sbit LSB=P2^<span class="number">3</span>;</span><br><span class="line">sbit LSC=P2^<span class="number">4</span>;</span><br><span class="line"></span><br><span class="line">sbit k1=P3^<span class="number">1</span>;</span><br><span class="line">sbit k2=P3^<span class="number">0</span>;</span><br><span class="line">sbit k3=P3^<span class="number">2</span>;</span><br><span class="line">sbit k4=P3^<span class="number">3</span>;       <span class="comment">//定义按键端口</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> num=<span class="number">0</span>;</span><br><span class="line">u8 disp[<span class="number">4</span>];</span><br><span class="line">u8 code smgduan[<span class="number">10</span>]=&#123;<span class="number">0x3f</span>,<span class="number">0x06</span>,<span class="number">0x5b</span>,<span class="number">0x4f</span>,<span class="number">0x66</span>,<span class="number">0x6d</span>,<span class="number">0x7d</span>,<span class="number">0x07</span>,<span class="number">0x7f</span>,<span class="number">0x6f</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">delay</span><span class="params">(u16 i)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">         <span class="keyword">while</span>(i--);         </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Keypros</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">         <span class="keyword">if</span>(k1==<span class="number">0</span>)</span><br><span class="line">         &#123;</span><br><span class="line">         <span class="built_in">delay</span>(<span class="number">1000</span>);  <span class="comment">//消抖处理</span></span><br><span class="line">         <span class="keyword">if</span>(k1==<span class="number">0</span>)</span><br><span class="line">         &#123;</span><br><span class="line">         At24c02Write(<span class="number">1</span>,num);       <span class="comment">//在地址1内写入数据num</span></span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">while</span>(!k1);</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">if</span>(k2==<span class="number">0</span>)</span><br><span class="line">         &#123;</span><br><span class="line">         <span class="built_in">delay</span>(<span class="number">1000</span>);  <span class="comment">//消抖处理</span></span><br><span class="line">         <span class="keyword">if</span>(k2==<span class="number">0</span>)</span><br><span class="line">         &#123;</span><br><span class="line">         num=At24c02Read(<span class="number">1</span>);        <span class="comment">//读取EEPROM地址1内的数据保存在num中</span></span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">while</span>(!k2);</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">if</span>(k3==<span class="number">0</span>)</span><br><span class="line">         &#123;</span><br><span class="line">         <span class="built_in">delay</span>(<span class="number">100</span>);  <span class="comment">//消抖处理</span></span><br><span class="line">         <span class="keyword">if</span>(k3==<span class="number">0</span>)</span><br><span class="line">         &#123;</span><br><span class="line">         num++;         <span class="comment">//数据加1</span></span><br><span class="line">         <span class="keyword">if</span>(num&gt;<span class="number">255</span>)num=<span class="number">0</span>;</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">while</span>(!k3);</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">if</span>(k4==<span class="number">0</span>)</span><br><span class="line">         &#123;</span><br><span class="line">         <span class="built_in">delay</span>(<span class="number">1000</span>);  <span class="comment">//消抖处理</span></span><br><span class="line">         <span class="keyword">if</span>(k4==<span class="number">0</span>)</span><br><span class="line">         &#123;</span><br><span class="line">         num=<span class="number">0</span>;       <span class="comment">//数据清零</span></span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">while</span>(!k4);</span><br><span class="line">         &#125;         </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">datapros</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">         disp[<span class="number">0</span>]=smgduan[num/<span class="number">1000</span>];<span class="comment">//千位</span></span><br><span class="line">         disp[<span class="number">1</span>]=smgduan[num%<span class="number">1000</span>/<span class="number">100</span>];<span class="comment">//百位</span></span><br><span class="line">         disp[<span class="number">2</span>]=smgduan[num%<span class="number">1000</span>%<span class="number">100</span>/<span class="number">10</span>];<span class="comment">//个位</span></span><br><span class="line">         disp[<span class="number">3</span>]=smgduan[num%<span class="number">1000</span>%<span class="number">100</span>%<span class="number">10</span>];         </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DigDisplay</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">         u8 i;</span><br><span class="line">         <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">4</span>;i++)</span><br><span class="line">         &#123;</span><br><span class="line">         <span class="keyword">switch</span>(i)       <span class="comment">//位选，选择点亮的数码管，</span></span><br><span class="line">         &#123;</span><br><span class="line">         <span class="keyword">case</span>(<span class="number">0</span>):</span><br><span class="line">         LSA=<span class="number">1</span>;LSB=<span class="number">1</span>;LSC=<span class="number">0</span>; <span class="keyword">break</span>;<span class="comment">//显示第0位</span></span><br><span class="line">         <span class="keyword">case</span>(<span class="number">1</span>):</span><br><span class="line">         LSA=<span class="number">0</span>;LSB=<span class="number">1</span>;LSC=<span class="number">0</span>; <span class="keyword">break</span>;<span class="comment">//显示第1位</span></span><br><span class="line">         <span class="keyword">case</span>(<span class="number">2</span>):</span><br><span class="line">         LSA=<span class="number">1</span>;LSB=<span class="number">0</span>;LSC=<span class="number">0</span>; <span class="keyword">break</span>;<span class="comment">//显示第2位</span></span><br><span class="line">         <span class="keyword">case</span>(<span class="number">3</span>):</span><br><span class="line">         LSA=<span class="number">0</span>;LSB=<span class="number">0</span>;LSC=<span class="number">0</span>; <span class="keyword">break</span>;<span class="comment">//显示第3位</span></span><br><span class="line">         &#125;</span><br><span class="line">         P0=disp[i];<span class="comment">//发送数据</span></span><br><span class="line">         <span class="built_in">delay</span>(<span class="number">100</span>); <span class="comment">//间隔一段时间扫描         </span></span><br><span class="line">         P0=<span class="number">0x00</span>;<span class="comment">//消隐</span></span><br><span class="line">         &#125;         </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;         </span><br><span class="line">         <span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">         &#123;</span><br><span class="line">         Keypros();       <span class="comment">//按键处理函数</span></span><br><span class="line">         datapros();       <span class="comment">//数据处理函数</span></span><br><span class="line">         DigDisplay();<span class="comment">//数码管显示函数         </span></span><br><span class="line">         &#125;         </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>I2C总线通过上拉电阻接正电源。当总线空闲时，两根线均为高电平。</li><li>I2C总线进行数据传送时，时钟信号为高电平期间，数据线上的数据必须保持稳定，只有在时钟线上的信号为低电平期间，数据线上的高电平或低电平状态才允许变化。即，SCL=1时，SDA稳定；SCL=0时，SDA可以变化。</li><li>起始信号和终止信号，相应和非响应（原理看PPT），如图，<img src="/img/loading.gif" data-lazy-src="/%E5%88%9D%E5%AD%A6%E5%8D%95%E7%89%87%E6%9C%BA2/4.png" title="图示"><br></li></ol><hr><h2 id="DS18B20温度传感器"><a href="#DS18B20温度传感器" class="headerlink" title="DS18B20温度传感器"></a>DS18B20温度传感器</h2><ol><li>主函数main.c代码：<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"reg52.h"</span>         <span class="comment">//此文件中定义了单片机的一些特殊功能寄存器</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"temp.h"</span>        </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">int</span> u16;       <span class="comment">//对数据类型进行声明定义</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">char</span> u8;</span><br><span class="line"></span><br><span class="line">sbit LSA=P2^<span class="number">2</span>;</span><br><span class="line">sbit LSB=P2^<span class="number">3</span>;</span><br><span class="line">sbit LSC=P2^<span class="number">4</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">u8 code smgduan[<span class="number">10</span>]=&#123;<span class="number">0x3f</span>,<span class="number">0x06</span>,<span class="number">0x5b</span>,<span class="number">0x4f</span>,<span class="number">0x66</span>,<span class="number">0x6d</span>,<span class="number">0x7d</span>,<span class="number">0x07</span>,<span class="number">0x7f</span>,<span class="number">0x6f</span>&#125;;</span><br><span class="line">u8 num=<span class="number">0</span>,DisplayData[<span class="number">8</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">delay</span><span class="params">(u16 i)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        <span class="keyword">while</span>(i--);        </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">datapros</span><span class="params">(<span class="keyword">int</span> temp)</span></span></span><br><span class="line"><span class="function"></span>&#123;       </span><br><span class="line">         <span class="keyword">float</span> tp;        </span><br><span class="line">         <span class="keyword">if</span>(temp&lt;<span class="number">0</span>)         <span class="comment">//温度数据处理       </span></span><br><span class="line">         &#123;</span><br><span class="line">        DisplayData[<span class="number">0</span>]=<span class="number">0x40</span>;       <span class="comment">//显示负号</span></span><br><span class="line">        temp=temp<span class="number">-1</span>;</span><br><span class="line">        temp=~temp;</span><br><span class="line">        tp=temp;</span><br><span class="line">        temp=tp*<span class="number">0.0625</span>*<span class="number">100</span>+<span class="number">0.5</span>;  </span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">else</span></span><br><span class="line">         &#123;</span><br><span class="line">        DisplayData[<span class="number">0</span>]=<span class="number">0x00</span>;</span><br><span class="line">        tp=temp;</span><br><span class="line">        temp=tp*<span class="number">0.0625</span>*<span class="number">100</span>+<span class="number">0.5</span>;</span><br><span class="line">         &#125;</span><br><span class="line"></span><br><span class="line">        DisplayData[<span class="number">1</span>]=smgduan[temp%<span class="number">10000</span>/<span class="number">1000</span>];<span class="comment">//十位</span></span><br><span class="line">        DisplayData[<span class="number">2</span>]=smgduan[temp%<span class="number">1000</span>/<span class="number">100</span>]|<span class="number">0x80</span>;<span class="comment">//个位</span></span><br><span class="line">        DisplayData[<span class="number">3</span>]=smgduan[temp%<span class="number">100</span>/<span class="number">10</span>];   <span class="comment">//小数点后1位</span></span><br><span class="line">        </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DigDisplay</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        u8 i;</span><br><span class="line">        <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">6</span>;i++)</span><br><span class="line">        &#123;</span><br><span class="line">        <span class="keyword">switch</span>(i)         <span class="comment">//位选，选择点亮的数码管，</span></span><br><span class="line">        &#123;</span><br><span class="line">        <span class="keyword">case</span>(<span class="number">0</span>):</span><br><span class="line">        LSA=<span class="number">1</span>;LSB=<span class="number">1</span>;LSC=<span class="number">0</span>; <span class="keyword">break</span>;<span class="comment">//显示第0位</span></span><br><span class="line">        <span class="keyword">case</span>(<span class="number">1</span>):</span><br><span class="line">        LSA=<span class="number">0</span>;LSB=<span class="number">1</span>;LSC=<span class="number">0</span>; <span class="keyword">break</span>;<span class="comment">//显示第1位</span></span><br><span class="line">        <span class="keyword">case</span>(<span class="number">2</span>):</span><br><span class="line">        LSA=<span class="number">1</span>;LSB=<span class="number">0</span>;LSC=<span class="number">0</span>; <span class="keyword">break</span>;<span class="comment">//显示第2位</span></span><br><span class="line">        <span class="keyword">case</span>(<span class="number">3</span>):</span><br><span class="line">        LSA=<span class="number">0</span>;LSB=<span class="number">0</span>;LSC=<span class="number">0</span>; <span class="keyword">break</span>;<span class="comment">//显示第3位</span></span><br><span class="line">        <span class="keyword">case</span>(<span class="number">4</span>):</span><br><span class="line">        LSA=<span class="number">0</span>;LSB=<span class="number">0</span>;LSC=<span class="number">1</span>; <span class="keyword">break</span>;<span class="comment">//显示第4位</span></span><br><span class="line">        <span class="keyword">case</span>(<span class="number">5</span>):</span><br><span class="line">        LSA=<span class="number">1</span>;LSB=<span class="number">0</span>;LSC=<span class="number">1</span>; <span class="keyword">break</span>;<span class="comment">//显示第5位</span></span><br><span class="line">        &#125;</span><br><span class="line">        P0=DisplayData[i];<span class="comment">//发送数据         改变数字显示位置</span></span><br><span class="line">        <span class="built_in">delay</span>(<span class="number">100</span>);       <span class="comment">//间隔一段时间扫描        </span></span><br><span class="line">        P0=<span class="number">0x00</span>;        <span class="comment">//消隐</span></span><br><span class="line">        &#125;        </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;        </span><br><span class="line">        <span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">        </span><br><span class="line">        datapros(Ds18b20ReadTemp());    <span class="comment">//数据处理函数</span></span><br><span class="line">        DigDisplay();       <span class="comment">//数码管显示函数        </span></span><br><span class="line">        &#125;        </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol></li><li>温度传感器代码temp.c部分<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"temp.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Delay1ms</span><span class="params">(uint y)</span>         <span class="comment">//带参数y</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    uint x;</span><br><span class="line">      <span class="keyword">for</span>(;y&gt;<span class="number">0</span>;y--)       <span class="comment">//控制延时几个1ms</span></span><br><span class="line">      &#123;</span><br><span class="line">         <span class="keyword">for</span>(x=<span class="number">110</span>;x&gt;<span class="number">0</span>;x--);       <span class="comment">//延时1ms</span></span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">uchar <span class="title">Ds18b20Init</span><span class="params">()</span>        <span class="comment">//DS18B20初始化</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   uchar i=<span class="number">0</span>;</span><br><span class="line">   DSPORT=<span class="number">0</span>;</span><br><span class="line">   i=<span class="number">70</span>;</span><br><span class="line">   <span class="keyword">while</span>(i--);          <span class="comment">//642us</span></span><br><span class="line">   DSPORT=<span class="number">1</span>;      <span class="comment">//拉高</span></span><br><span class="line">   i=<span class="number">0</span>;</span><br><span class="line">   <span class="keyword">while</span>(DSPORT);</span><br><span class="line">   &#123;</span><br><span class="line">        Delay1ms(<span class="number">1</span>);</span><br><span class="line">        i++;</span><br><span class="line">        <span class="keyword">if</span>(i&gt;<span class="number">5</span>)</span><br><span class="line">        &#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> <span class="number">1</span>;      <span class="comment">//1存在  0不存在</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Ds18b20WriteByte</span><span class="params">(uchar dat)</span>       <span class="comment">//写字节时序</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   uchar i,j;</span><br><span class="line">   <span class="keyword">for</span>(j=<span class="number">0</span>;j&lt;<span class="number">8</span>;j++)      <span class="comment">//8字节</span></span><br><span class="line">   &#123;</span><br><span class="line">           DSPORT=<span class="number">0</span>;</span><br><span class="line">        i++;      <span class="comment">//小延时</span></span><br><span class="line">        DSPORT=dat&amp;<span class="number">0x01</span>;      <span class="comment">//取最低位，与运算</span></span><br><span class="line">        i=<span class="number">6</span>;</span><br><span class="line">        <span class="keyword">while</span>(i--);       <span class="comment">//68us</span></span><br><span class="line">        DSPORT=<span class="number">1</span>;      <span class="comment">//拉高</span></span><br><span class="line">        dat&gt;&gt;=<span class="number">1</span>;      <span class="comment">//将最低位移出去，移位操作</span></span><br><span class="line">   &#125; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">uchar <span class="title">Ds18b20ReadByte</span><span class="params">()</span>         <span class="comment">//读取字节</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">      uint i,j;</span><br><span class="line">        uchar bi,<span class="keyword">byte</span>;</span><br><span class="line">        <span class="keyword">for</span>(j=<span class="number">8</span>;j&gt;<span class="number">0</span>;j--)</span><br><span class="line">        &#123;</span><br><span class="line">          DSPORT=<span class="number">0</span>;</span><br><span class="line">      i++;         <span class="comment">//  &gt;1us</span></span><br><span class="line">      DSPORT=<span class="number">1</span>;</span><br><span class="line">      i++;         <span class="comment">//byte=1000 0000右移0100 0000   DSPORT=0；</span></span><br><span class="line">      i++;</span><br><span class="line">      bi=DSPORT;</span><br><span class="line">      <span class="keyword">byte</span>=(<span class="keyword">byte</span>&gt;&gt;<span class="number">1</span>)|(bi&lt;&lt;<span class="number">7</span>);   <span class="comment">//bi左移7位，到最高位</span></span><br><span class="line">      i=<span class="number">4</span>;</span><br><span class="line">      <span class="keyword">while</span>(i--);              <span class="comment">//45us</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">byte</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Ds18b20ChangeTemp</span><span class="params">()</span>       <span class="comment">//温度转换</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">      Ds18b20Init();</span><br><span class="line">      Delay1ms(<span class="number">1</span>);</span><br><span class="line">      Ds18b20WriteByte(<span class="number">0xcc</span>);       <span class="comment">//开始温度转换</span></span><br><span class="line">      Ds18b20WriteByte(<span class="number">0x44</span>);       <span class="comment">//启动温度传感器转换</span></span><br><span class="line"></span><br><span class="line">&#125;    </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Ds18b20ReadTempCom</span><span class="params">()</span>      <span class="comment">//读取数据</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   Ds18b20Init();</span><br><span class="line">      Delay1ms(<span class="number">1</span>);</span><br><span class="line">      Ds18b20WriteByte(<span class="number">0xcc</span>);       <span class="comment">//开始温度转换</span></span><br><span class="line">      Ds18b20WriteByte(<span class="number">0xBE</span>);       <span class="comment">//读取温度数据</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Ds18b20ReadTemp</span><span class="params">()</span>       <span class="comment">//真正读取温度</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="keyword">int</span> temp=<span class="number">0</span>;</span><br><span class="line">   uchar tmh,tml;</span><br><span class="line">   Ds18b20ChangeTemp();</span><br><span class="line">   Ds18b20ReadTempCom();</span><br><span class="line">   tml=Ds18b20ReadByte();        <span class="comment">//低字节</span></span><br><span class="line">   tmh=Ds18b20ReadByte();         <span class="comment">//高字节</span></span><br><span class="line">   temp=tmh;        </span><br><span class="line">   temp&lt;&lt;=<span class="number">8</span>;        <span class="comment">//高8位已经过去</span></span><br><span class="line">   temp|=tml;        <span class="comment">//把温度低八位也弄进去</span></span><br><span class="line">   <span class="keyword">return</span> temp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>头文件temp.h部分<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> _temp_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> _temp_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;reg52.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> uchar</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> uchar unsigned char</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> uint                   <span class="comment">//用uint代替</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> uint unsigned int      <span class="comment">//定义无符号整形</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">sbit DSPORT=P3^<span class="number">7</span>;          <span class="comment">//传感器I/O口对应P37</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Ds18b20ReadTemp</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure><blockquote><ol><li>temp.c部分原理<br></li></ol></blockquote></li><li>DS18B20的初始化：<br><br>(1).数据线拉到低电平“0”。<br><br>(2).延时480微妙（该时间的时间范围可以从480到960微妙）。<br><br>(3).数据线拉到高电平“1”。<br><br>(4).延时等待80微妙。如果初始化成功则在15到60微妙时间内产生一个由DS18B20所返回的低电平“0”.根据该状态可以来确定它的存在，但是应注意不能无限的进行等待，不然会使程序进入死循环，所以要进行超时判断。<br><br>(5).若CPU读到了数据线上的低电平“0”后，还要做延时，其延时的时间从发出的高电平算起（第（3）步的时间算起）最少要480微妙。<br><br>时序图：<br><img src="/img/loading.gif" data-lazy-src="/%E5%88%9D%E5%AD%A6%E5%8D%95%E7%89%87%E6%9C%BA2/5.png" title="图示"></li><li>DS18B20写时序：<br><br>(1).数据线先置低电平“0”<br><br>(2).延时15微妙。<br><br>(3).按从低位到高位的顺序发送数据(一次只发送一位)。<br><br>(4).延时60微妙。<br><br>(5).将数据线拉到高电平。<br><br>(6).重复1～5步骤，直到发送完整的字节。<br><br>(7).最后将数据线拉高。<br><br>时序图：<br><img src="/img/loading.gif" data-lazy-src="/%E5%88%9D%E5%AD%A6%E5%8D%95%E7%89%87%E6%9C%BA2/7.png" title="图示"></li><li>DS18B20读时序：<br><br>(1).将数据线拉低“0”。<br><br>(2).延时1微妙。<br><br>(3).将数据线拉高“1”,释放总线准备读数据。<br><br>(4).延时10微妙。<br><br>(5).读数据线的状态得到1个状态位，并进行数据处理。<br><br>(6).延时45微妙。<br><br>(7).重复1～7步骤，直到读完一个字节。<br><br>时序图：<br><img src="/img/loading.gif" data-lazy-src="/%E5%88%9D%E5%AD%A6%E5%8D%95%E7%89%87%E6%9C%BA2/6.png" title="图示"><blockquote><ol start="2"><li>温度转换</li></ol></blockquote></li><li>这是12位转化后得到的12位数据，存储在DS18B20的两个8位的RAM中，高字节的前5位是符号位，如果测得的温度大于0，这5位为‘0’，只要将测到的数值乘以0.0625即可得到实际温度；如果温度小于0，这5位为‘1’，测到的数值需要先减1再取反再乘以0.0625即可得到实际温度。如图：<img src="/img/loading.gif" data-lazy-src="/%E5%88%9D%E5%AD%A6%E5%8D%95%E7%89%87%E6%9C%BA2/8.png" title="图示"><br><br>举个例子：85度=0000 0101 0101 0000<br><br>前五位为0+1x2^6+1x2^4+1x2^2+1x2^0=64+16+4+1=85.</li></ol><hr><h2 id="液晶1602显示"><a href="#液晶1602显示" class="headerlink" title="液晶1602显示"></a>液晶1602显示</h2><p>效果如图：<img src="/img/loading.gif" data-lazy-src="/%E5%88%9D%E5%AD%A6%E5%8D%95%E7%89%87%E6%9C%BA2/9.jpg" title="图示"></p><ol><li>主程序代码：<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"reg52.h"</span>           <span class="comment">//此文件中定义了单片机的一些特殊功能寄存器</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"lcd.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">int</span> u16;         <span class="comment">//对数据类型进行声明定义</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">char</span> u8;</span><br><span class="line"></span><br><span class="line">u8 Disp[]=<span class="string">"    my blog     "</span>;</span><br><span class="line">u8 Disp2[]=<span class="string">"   cjl52.top    "</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">       u8 i,j;</span><br><span class="line">       LcdInit();</span><br><span class="line">       LcdWriteCom(<span class="number">0x80</span>);         <span class="comment">//设置数据指针起点：第一行</span></span><br><span class="line">       </span><br><span class="line">       <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">16</span>;i++)</span><br><span class="line">       &#123;</span><br><span class="line">       LcdWriteData(Disp[i]);       </span><br><span class="line">       &#125;</span><br><span class="line">       Lcd1602_Delay1ms(<span class="number">5</span>);</span><br><span class="line">       </span><br><span class="line">       LcdWriteCom(<span class="number">0x80</span>+<span class="number">0x40</span>);         <span class="comment">//设置数据指针起点：第二行</span></span><br><span class="line">       <span class="keyword">for</span>(j=<span class="number">0</span>;j&lt;<span class="number">16</span>;j++)</span><br><span class="line">       &#123;</span><br><span class="line">       LcdWriteData(Disp2[j]);       </span><br><span class="line">       &#125;</span><br><span class="line">       </span><br><span class="line">       <span class="keyword">while</span>(<span class="number">1</span>);       </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>lcd.c液晶原理代码：<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"lcd.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Lcd1602_Delay1ms</span><span class="params">(uint c)</span>       <span class="comment">//误差 0us          延时1ms</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    uchar a,b;</span><br><span class="line">        <span class="keyword">for</span> (; c&gt;<span class="number">0</span>; c--)</span><br><span class="line">        &#123;</span><br><span class="line">         <span class="keyword">for</span> (b=<span class="number">199</span>;b&gt;<span class="number">0</span>;b--)</span><br><span class="line">         &#123;</span><br><span class="line">                  <span class="keyword">for</span>(a=<span class="number">1</span>;a&gt;<span class="number">0</span>;a--);</span><br><span class="line">         &#125;      </span><br><span class="line">        &#125;</span><br><span class="line">            </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span>         LCD1602_4PINS         <span class="comment">//当没有定义这个LCD1602_4PINS时</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">LcdWriteCom</span><span class="params">(uchar com)</span>          <span class="comment">//写入命令</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        LCD1602_E = <span class="number">0</span>;     <span class="comment">//使能</span></span><br><span class="line">        LCD1602_RS = <span class="number">0</span>;           <span class="comment">//选择发送命令</span></span><br><span class="line">        LCD1602_RW = <span class="number">0</span>;           <span class="comment">//选择写入</span></span><br><span class="line">        </span><br><span class="line">        LCD1602_DATAPINS = com;     <span class="comment">//放入命令          P0 是LCD1602_DATAPINS </span></span><br><span class="line">        Lcd1602_Delay1ms(<span class="number">1</span>);        <span class="comment">//等待数据稳定</span></span><br><span class="line"></span><br><span class="line">        LCD1602_E = <span class="number">1</span>;                  <span class="comment">//写入时序</span></span><br><span class="line">        Lcd1602_Delay1ms(<span class="number">5</span>);          <span class="comment">//保持时间</span></span><br><span class="line">        LCD1602_E = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span> </span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">LcdWriteCom</span><span class="params">(uchar com)</span>          <span class="comment">//写入命令</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        LCD1602_E = <span class="number">0</span>;         <span class="comment">//使能清零</span></span><br><span class="line">        LCD1602_RS = <span class="number">0</span>;         <span class="comment">//选择写入命令</span></span><br><span class="line">        LCD1602_RW = <span class="number">0</span>;         <span class="comment">//选择写入</span></span><br><span class="line"></span><br><span class="line">        LCD1602_DATAPINS = com;        <span class="comment">//由于4位的接线是接到P0口的高四位，所以传送高四位不用改</span></span><br><span class="line">        Lcd1602_Delay1ms(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        LCD1602_E = <span class="number">1</span>;         <span class="comment">//写入时序</span></span><br><span class="line">        Lcd1602_Delay1ms(<span class="number">5</span>);</span><br><span class="line">        LCD1602_E = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        LCD1602_DATAPINS = com &lt;&lt; <span class="number">4</span>; <span class="comment">//发送低四位</span></span><br><span class="line">        Lcd1602_Delay1ms(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        LCD1602_E = <span class="number">1</span>;         <span class="comment">//写入时序</span></span><br><span class="line">        Lcd1602_Delay1ms(<span class="number">5</span>);</span><br><span class="line">        LCD1602_E = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">        </span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span>         LCD1602_4PINS           </span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">LcdWriteData</span><span class="params">(uchar dat)</span>        <span class="comment">//写入数据</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        LCD1602_E = <span class="number">0</span>;        <span class="comment">//使能清零</span></span><br><span class="line">        LCD1602_RS = <span class="number">1</span>;        <span class="comment">//选择输入数据</span></span><br><span class="line">        LCD1602_RW = <span class="number">0</span>;        <span class="comment">//选择写入</span></span><br><span class="line"></span><br><span class="line">        LCD1602_DATAPINS = dat; <span class="comment">//写入数据</span></span><br><span class="line">        Lcd1602_Delay1ms(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        LCD1602_E = <span class="number">1</span>;   <span class="comment">//写入时序</span></span><br><span class="line">        Lcd1602_Delay1ms(<span class="number">5</span>);   <span class="comment">//保持时间</span></span><br><span class="line">        LCD1602_E = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">LcdWriteData</span><span class="params">(uchar dat)</span>        <span class="comment">//写入数据</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        LCD1602_E = <span class="number">0</span>;          <span class="comment">//使能清零</span></span><br><span class="line">        LCD1602_RS = <span class="number">1</span>;          <span class="comment">//选择写入数据</span></span><br><span class="line">        LCD1602_RW = <span class="number">0</span>;          <span class="comment">//选择写入</span></span><br><span class="line"></span><br><span class="line">        LCD1602_DATAPINS = dat;        <span class="comment">//由于4位的接线是接到P0口的高四位，所以传送高四位不用改</span></span><br><span class="line">        Lcd1602_Delay1ms(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        LCD1602_E = <span class="number">1</span>;          <span class="comment">//写入时序</span></span><br><span class="line">        Lcd1602_Delay1ms(<span class="number">5</span>);</span><br><span class="line">        LCD1602_E = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        LCD1602_DATAPINS = dat&lt;&lt;<span class="number">4</span>; <span class="comment">//写入低四位</span></span><br><span class="line">        Lcd1602_Delay1ms(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        LCD1602_E = <span class="number">1</span>;          <span class="comment">//写入时序</span></span><br><span class="line">        Lcd1602_Delay1ms(<span class="number">5</span>);</span><br><span class="line">        LCD1602_E = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">         </span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span>        LCD1602_4PINS</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">LcdInit</span><span class="params">()</span>          <span class="comment">//LCD初始化子程序</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">         LcdWriteCom(<span class="number">0x38</span>);  <span class="comment">//开显示</span></span><br><span class="line">        LcdWriteCom(<span class="number">0x0c</span>);  <span class="comment">//开显示不显示光标</span></span><br><span class="line">        LcdWriteCom(<span class="number">0x06</span>);  <span class="comment">//写一个指针加1</span></span><br><span class="line">        LcdWriteCom(<span class="number">0x01</span>);  <span class="comment">//清屏</span></span><br><span class="line">        LcdWriteCom(<span class="number">0x80</span>);  <span class="comment">//设置数据指针起点</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">LcdInit</span><span class="params">()</span>          <span class="comment">//LCD初始化子程序</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        LcdWriteCom(<span class="number">0x32</span>);         <span class="comment">//将8位总线转为4位总线</span></span><br><span class="line">        LcdWriteCom(<span class="number">0x28</span>);         <span class="comment">//在四位线下的初始化</span></span><br><span class="line">        LcdWriteCom(<span class="number">0x0c</span>);  <span class="comment">//开显示不显示光标</span></span><br><span class="line">        LcdWriteCom(<span class="number">0x06</span>);  <span class="comment">//写一个指针加1</span></span><br><span class="line">        LcdWriteCom(<span class="number">0x01</span>);  <span class="comment">//清屏</span></span><br><span class="line">        LcdWriteCom(<span class="number">0x80</span>);  <span class="comment">//设置数据指针起点</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure></li><li>lcd.h头文件代码：<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> __LCD_H_</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __LCD_H_</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//#define LCD1602_4PINS     当使用的是4位数据传输的时候定义，就是有转接板（像TTL-USB）,使用8位取消这个定义(有转接板定义，无转接板注释掉)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;reg52.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> uchar</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> uchar unsigned char</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> uint </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> uint unsigned int</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LCD1602_DATAPINS P0    <span class="comment">//定义接口</span></span></span><br><span class="line">sbit LCD1602_E=P2^<span class="number">7</span>;</span><br><span class="line">sbit LCD1602_RW=P2^<span class="number">5</span>;</span><br><span class="line">sbit LCD1602_RS=P2^<span class="number">6</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Lcd1602_Delay1ms</span><span class="params">(uint c)</span></span>;   <span class="comment">//误差 0us</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">LcdWriteCom</span><span class="params">(uchar com)</span></span>;    <span class="comment">//LCD1602写入8位命令子函数</span></span><br><span class="line">                </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">LcdWriteData</span><span class="params">(uchar dat)</span></span>;   <span class="comment">//LCD1602写入8位数据子函数</span></span><br><span class="line">                </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">LcdInit</span><span class="params">()</span></span>;                         <span class="comment">//LCD1602初始化子程序                           </span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure><blockquote><p>原理PPT里的知识很多，我找到了网上一篇精简的（懒人行为）：<a href="https://wenku.baidu.com/view/435c3ba0284ac850ad024299.html" target="_blank" rel="noopener">液晶1602原理</a>.</p></blockquote></li></ol><hr><h2 id="红外原理"><a href="#红外原理" class="headerlink" title="红外原理"></a>红外原理</h2><p>实验现象：按遥控器上某按键会显示其按键的16进制数据码。如图:<img src="/img/loading.gif" data-lazy-src="/%E5%88%9D%E5%AD%A6%E5%8D%95%E7%89%87%E6%9C%BA2/10.jpg" title="图示"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"reg52.h"</span>                          <span class="comment">//此文件中定义了单片机的一些特殊功能寄存器</span></span></span><br><span class="line">                </span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">int</span> u16;                  <span class="comment">//对数据类型进行声明定义</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">char</span> u8;</span><br><span class="line"></span><br><span class="line">sbit LSA=P2^<span class="number">2</span>;                   <span class="comment">//之前的38译码器</span></span><br><span class="line">sbit LSB=P2^<span class="number">3</span>;</span><br><span class="line">sbit LSC=P2^<span class="number">4</span>;</span><br><span class="line"></span><br><span class="line">sbit IRIN=P3^<span class="number">2</span>;                 <span class="comment">//P32口为数据传输口</span></span><br><span class="line"></span><br><span class="line">u8 IrValue[<span class="number">6</span>];</span><br><span class="line">u8 Time;</span><br><span class="line"></span><br><span class="line">u8 DisplayData[<span class="number">8</span>];</span><br><span class="line">u8 code smgduan[<span class="number">17</span>]=&#123;</span><br><span class="line"><span class="number">0x3f</span>,<span class="number">0x06</span>,<span class="number">0x5b</span>,<span class="number">0x4f</span>,<span class="number">0x66</span>,<span class="number">0x6d</span>,<span class="number">0x7d</span>,<span class="number">0x07</span>,</span><br><span class="line"><span class="number">0x7f</span>,<span class="number">0x6f</span>,<span class="number">0x77</span>,<span class="number">0x7c</span>,<span class="number">0x39</span>,<span class="number">0x5e</span>,<span class="number">0x79</span>,<span class="number">0x71</span>,<span class="number">0X76</span>&#125;;     <span class="comment">//0、1、2、3、4、5、6、7、8、9、A、b、C、d、E、F、H的显示码</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">delay</span><span class="params">(u16 i)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">                <span class="keyword">while</span>(i--);                </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DigDisplay</span><span class="params">()</span>                <span class="comment">//之前的数码管显示</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">                u8 i;</span><br><span class="line">                <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++)</span><br><span class="line">                &#123;</span><br><span class="line">         <span class="keyword">switch</span>(i)                    <span class="comment">//位选，选择点亮的数码管，</span></span><br><span class="line">         &#123;</span><br><span class="line">                         <span class="keyword">case</span>(<span class="number">0</span>):</span><br><span class="line">         LSA=<span class="number">1</span>;LSB=<span class="number">1</span>;LSC=<span class="number">1</span>; <span class="keyword">break</span>;   <span class="comment">//显示第0位                </span></span><br><span class="line">                         <span class="keyword">case</span>(<span class="number">1</span>):</span><br><span class="line">         LSA=<span class="number">0</span>;LSB=<span class="number">1</span>;LSC=<span class="number">1</span>; <span class="keyword">break</span>;   <span class="comment">//显示第1位</span></span><br><span class="line">                         <span class="keyword">case</span>(<span class="number">2</span>):</span><br><span class="line">         LSA=<span class="number">1</span>;LSB=<span class="number">0</span>;LSC=<span class="number">1</span>; <span class="keyword">break</span>;   <span class="comment">//显示第2位 </span></span><br><span class="line">         &#125;</span><br><span class="line">         P0=DisplayData[i];<span class="comment">//发送数据</span></span><br><span class="line">         <span class="built_in">delay</span>(<span class="number">100</span>); <span class="comment">//间隔一段时间扫描                </span></span><br><span class="line">         P0=<span class="number">0x00</span>;<span class="comment">//消隐</span></span><br><span class="line">                &#125;         </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">IrInit</span><span class="params">()</span>                <span class="comment">//初始化，因为P32口也是外部中断0的接口</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">                IT0=<span class="number">1</span>;  <span class="comment">//下降沿触发</span></span><br><span class="line">                EX0=<span class="number">1</span>;  <span class="comment">//打开中断0允许</span></span><br><span class="line">                EA=<span class="number">1</span>;                <span class="comment">//打开总中断</span></span><br><span class="line"></span><br><span class="line">                IRIN=<span class="number">1</span>; <span class="comment">//初始化端口 上拉高电平</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;                </span><br><span class="line">                IrInit(); </span><br><span class="line">                <span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">                &#123;                </span><br><span class="line">         DisplayData[<span class="number">0</span>] = smgduan[IrValue[<span class="number">2</span>]/<span class="number">16</span>]; <span class="comment">//÷16得到16进制高位</span></span><br><span class="line">         DisplayData[<span class="number">1</span>] = smgduan[IrValue[<span class="number">2</span>]%<span class="number">16</span>]; <span class="comment">//%16得到16进制低位</span></span><br><span class="line">         DisplayData[<span class="number">2</span>] = smgduan[<span class="number">16</span>];           <span class="comment">// 显示H，表示16进制表示数</span></span><br><span class="line">                 DigDisplay();                       <span class="comment">//引用数码管显示</span></span><br><span class="line">                &#125;         </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ReadIr</span><span class="params">()</span> interrupt 0              <span class="comment">//外部中断函数定义，注意中断号</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">                u8 j,k;          <span class="comment">//定义变量</span></span><br><span class="line">                u16 err;         </span><br><span class="line">                Time=<span class="number">0</span>;         <span class="comment">//时间变量                          </span></span><br><span class="line">                <span class="built_in">delay</span>(<span class="number">700</span>);                <span class="comment">//7ms  起始码</span></span><br><span class="line">                <span class="keyword">if</span>(IRIN==<span class="number">0</span>)         <span class="comment">//确认是否真的接收到正确的信号</span></span><br><span class="line">                &#123;                 </span><br><span class="line">         </span><br><span class="line">         err=<span class="number">1000</span>;         <span class="comment">//1000*10us=10ms,超过说明接收到错误的信号</span></span><br><span class="line"></span><br><span class="line">         <span class="keyword">while</span>((IRIN==<span class="number">0</span>)&amp;&amp;(err&gt;<span class="number">0</span>))                <span class="comment">//等待前面9ms的低电平过去           </span></span><br><span class="line">         &#123;                         </span><br><span class="line">                <span class="built_in">delay</span>(<span class="number">1</span>);                   <span class="comment">//10us</span></span><br><span class="line">                err--;             <span class="comment">//10us*1000=10000us=10ms</span></span><br><span class="line">         &#125; </span><br><span class="line">         <span class="keyword">if</span>(IRIN==<span class="number">1</span>)                         <span class="comment">//如果正确等到9ms低电平</span></span><br><span class="line">         &#123;</span><br><span class="line">        err=<span class="number">500</span>;</span><br><span class="line">        <span class="keyword">while</span>((IRIN==<span class="number">1</span>)&amp;&amp;(err&gt;<span class="number">0</span>))    <span class="comment">//等待4.5ms的起始高电平过去</span></span><br><span class="line">        &#123;</span><br><span class="line">                <span class="built_in">delay</span>(<span class="number">1</span>);</span><br><span class="line">                 err--;            <span class="comment">//5ms 后强制退出</span></span><br><span class="line">        &#125;</span><br><span class="line">                <span class="keyword">for</span>(k=<span class="number">0</span>;k&lt;<span class="number">4</span>;k++)         <span class="comment">//共有4组数据  4个字节数据码</span></span><br><span class="line">                &#123;         </span><br><span class="line">                <span class="keyword">for</span>(j=<span class="number">0</span>;j&lt;<span class="number">8</span>;j++)                <span class="comment">//接收一组数据 4*8=32</span></span><br><span class="line">                &#123;</span><br><span class="line"></span><br><span class="line">                err=<span class="number">60</span>;         </span><br><span class="line">                <span class="keyword">while</span>((IRIN==<span class="number">0</span>)&amp;&amp;(err&gt;<span class="number">0</span>))<span class="comment">//等待信号前面的560us低电平过去</span></span><br><span class="line">                &#123;                       <span class="comment">//PPM脉冲调制方式</span></span><br><span class="line">                <span class="built_in">delay</span>(<span class="number">1</span>);           <span class="comment">//10us</span></span><br><span class="line">                err--;           <span class="comment">//60*10=600us</span></span><br><span class="line">                &#125;</span><br><span class="line">                err=<span class="number">500</span>;</span><br><span class="line">                <span class="keyword">while</span>((IRIN==<span class="number">1</span>)&amp;&amp;(err&gt;<span class="number">0</span>))                 <span class="comment">//计算高电平的时间长度。</span></span><br><span class="line">                &#123;</span><br><span class="line">                <span class="built_in">delay</span>(<span class="number">10</span>);                 <span class="comment">//0.1ms</span></span><br><span class="line">                Time++;</span><br><span class="line">                err--;</span><br><span class="line">                <span class="keyword">if</span>(Time&gt;<span class="number">30</span>)         <span class="comment">//若高电平时间超过3ms,强制退出（失败） </span></span><br><span class="line">                &#123;</span><br><span class="line">                   <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                IrValue[k]&gt;&gt;=<span class="number">1</span>;                    <span class="comment">//k表示第几组数据</span></span><br><span class="line">                <span class="keyword">if</span>(Time&gt;=<span class="number">8</span>)                         <span class="comment">//如果高电平出现大于565us，那么是1</span></span><br><span class="line">                &#123;</span><br><span class="line">                IrValue[k]|=<span class="number">0x80</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                Time=<span class="number">0</span>;         <span class="comment">//用完时间要重新赋值                         </span></span><br><span class="line">                &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(IrValue[<span class="number">2</span>]!=~IrValue[<span class="number">3</span>])   <span class="comment">//验证数据码与数据反码，验证是否正确，错误就退出</span></span><br><span class="line">                &#123;</span><br><span class="line">                  <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                      &#125;                         </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>原理：</p><ol><li>红外发送装置发出二进制脉冲码，程序里的是PPM码（脉冲位置调制码，脉冲串之间的时间间隔来实现信号调制）。<img src="/img/loading.gif" data-lazy-src="/%E5%88%9D%E5%AD%A6%E5%8D%95%E7%89%87%E6%9C%BA2/11.png" title="图示">,可以看出：用户码或数据码中的每一个位可以是位 ‘1’ ，也可以是位 ‘0’。区分 ‘0’和 ‘1’是利用脉冲的时间间隔来区分，这种编码方式称为脉冲位置调制方式。</li><li>数据格式包括了引导码、用户码、数据码和数据码反码，编码总占32位。数据反码是数据码反相后的编码，编码时可用于对数据的纠错。注意：第二段的用户码也可以在遥控应用电路中被设置成第一段用户码的反码。<img src="/img/loading.gif" data-lazy-src="/%E5%88%9D%E5%AD%A6%E5%8D%95%E7%89%87%E6%9C%BA2/12.png" title="图示"></li></ol><blockquote><p>所为遥控器其实是个红外发送装置，单片机上的为红外接受装置。发射装置已经完备封装在遥控器内，所以我们做的就是写红外接收的程序代码。</p></blockquote><p>根据遥控器上每个按键的二进制脉冲码的不同，可以设计很多小玩意，比如遥控器控制LED灯（我已经自己实践过，挺好玩！）。所以得知道每个按键的二进制脉冲码，根据上面的实验其实可以弄出来，这里给个总结的表格。<img src="/img/loading.gif" data-lazy-src="/%E5%88%9D%E5%AD%A6%E5%8D%95%E7%89%87%E6%9C%BA2/13.png" title="图示"></p><table><tr><td>45H</td><td>46H</td><td>47H</td></tr><tr><td>44H</td><td>40H</td><td>43H</td></tr><tr><td>07H</td><td>15H</td><td>09H</td></tr><tr><td>16H</td><td>19H</td><td>0DH</td></tr><tr><td>0CH</td><td>18H</td><td>5EH</td></tr><tr><td>08H</td><td>1CH</td><td>5AH</td></tr><tr><td>42H</td><td>52H</td><td>4AH</td></tr></table><hr><h2 id="DS1302时钟"><a href="#DS1302时钟" class="headerlink" title="DS1302时钟"></a>DS1302时钟</h2><p>DS1302实时时钟具有能计算2100年之前的秒、分、时、日、日期、星期、月、年的能力，还有闰年调整的能力。<br>主函数main.c代码：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"reg52.h"</span>                </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"ds1302.h"</span>                </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">int</span> u16;                  </span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">char</span> u8;</span><br><span class="line"></span><br><span class="line">sbit LSA=P2^<span class="number">2</span>;              <span class="comment">//数码管38译码用</span></span><br><span class="line">sbit LSB=P2^<span class="number">3</span>;</span><br><span class="line">sbit LSC=P2^<span class="number">4</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> num=<span class="number">0</span>;</span><br><span class="line">u8 DisplayData[<span class="number">8</span>];</span><br><span class="line">u8 code smgduan[<span class="number">10</span>]=&#123;<span class="number">0x3f</span>,<span class="number">0x06</span>,<span class="number">0x5b</span>,<span class="number">0x4f</span>,<span class="number">0x66</span>,<span class="number">0x6d</span>,<span class="number">0x7d</span>,<span class="number">0x07</span>,<span class="number">0x7f</span>,<span class="number">0x6f</span>&#125;; <span class="comment">//显示数字0-9</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">delay</span><span class="params">(u16 i)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">     <span class="keyword">while</span>(i--);                </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">datapros</span><span class="params">()</span>         <span class="comment">//数据处理转换函数</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        Ds1302ReadTime();</span><br><span class="line">        DisplayData[<span class="number">0</span>] = smgduan[TIME[<span class="number">2</span>]/<span class="number">16</span>];         <span class="comment">//时    </span></span><br><span class="line">        DisplayData[<span class="number">1</span>] = smgduan[TIME[<span class="number">2</span>]&amp;<span class="number">0x0f</span>];                 </span><br><span class="line">        DisplayData[<span class="number">2</span>] = <span class="number">0x40</span>;</span><br><span class="line">        DisplayData[<span class="number">3</span>] = smgduan[TIME[<span class="number">1</span>]/<span class="number">16</span>];         <span class="comment">//分       </span></span><br><span class="line">        DisplayData[<span class="number">4</span>] = smgduan[TIME[<span class="number">1</span>]&amp;<span class="number">0x0f</span>];                </span><br><span class="line">        DisplayData[<span class="number">5</span>] = <span class="number">0x40</span>;</span><br><span class="line">        DisplayData[<span class="number">6</span>] = smgduan[TIME[<span class="number">0</span>]/<span class="number">16</span>];         <span class="comment">//秒       </span></span><br><span class="line">        DisplayData[<span class="number">7</span>] = smgduan[TIME[<span class="number">0</span>]&amp;<span class="number">0x0f</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DigDisplay</span><span class="params">()</span>         <span class="comment">//显示数码管</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        u8 i;</span><br><span class="line">        <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">8</span>;i++)</span><br><span class="line">        &#123;</span><br><span class="line">        <span class="keyword">switch</span>(i)                 </span><br><span class="line">        &#123;</span><br><span class="line">        <span class="keyword">case</span>(<span class="number">0</span>):</span><br><span class="line">        LSA=<span class="number">1</span>;LSB=<span class="number">1</span>;LSC=<span class="number">1</span>; <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span>(<span class="number">1</span>):</span><br><span class="line">        LSA=<span class="number">0</span>;LSB=<span class="number">1</span>;LSC=<span class="number">1</span>; <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span>(<span class="number">2</span>):</span><br><span class="line">        LSA=<span class="number">1</span>;LSB=<span class="number">0</span>;LSC=<span class="number">1</span>; <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span>(<span class="number">3</span>):</span><br><span class="line">        LSA=<span class="number">0</span>;LSB=<span class="number">0</span>;LSC=<span class="number">1</span>; <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span>(<span class="number">4</span>):</span><br><span class="line">        LSA=<span class="number">1</span>;LSB=<span class="number">1</span>;LSC=<span class="number">0</span>; <span class="keyword">break</span>;</span><br><span class="line">         <span class="keyword">case</span>(<span class="number">5</span>):</span><br><span class="line">        LSA=<span class="number">0</span>;LSB=<span class="number">1</span>;LSC=<span class="number">0</span>; <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span>(<span class="number">6</span>):</span><br><span class="line">        LSA=<span class="number">1</span>;LSB=<span class="number">0</span>;LSC=<span class="number">0</span>; <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span>(<span class="number">7</span>):</span><br><span class="line">        LSA=<span class="number">0</span>;LSB=<span class="number">0</span>;LSC=<span class="number">0</span>; <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        P0=DisplayData[i];</span><br><span class="line">        <span class="built_in">delay</span>(<span class="number">100</span>); </span><br><span class="line">        P0=<span class="number">0x00</span>;</span><br><span class="line">        &#125;                </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;                </span><br><span class="line">        <span class="comment">//Ds1302Init();    //第一次初始化后就可以注释该条语句，这样下次重启就不会再次初始化了       </span></span><br><span class="line">        <span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">        datapros();                </span><br><span class="line">        DigDisplay();                </span><br><span class="line">        &#125;                </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>模块DS1302.c的代码：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">"ds1302.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//---DS1302写入和读取时分秒的地址命令---//</span></span><br><span class="line"><span class="comment">//---秒分时日月周年 最低位读写位;-------//</span></span><br><span class="line">uchar code READ_RTC_ADDR[<span class="number">7</span>] = &#123;<span class="number">0x81</span>, <span class="number">0x83</span>, <span class="number">0x85</span>, <span class="number">0x87</span>, <span class="number">0x89</span>, <span class="number">0x8b</span>, <span class="number">0x8d</span>&#125;; </span><br><span class="line">uchar code WRITE_RTC_ADDR[<span class="number">7</span>] = &#123;<span class="number">0x80</span>, <span class="number">0x82</span>, <span class="number">0x84</span>, <span class="number">0x86</span>, <span class="number">0x88</span>, <span class="number">0x8a</span>, <span class="number">0x8c</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//---DS1302时钟初始化2016年5月7日星期六12点00分00秒。---//</span></span><br><span class="line"><span class="comment">//---存储顺序是秒分时日月周年,存储格式是用BCD码---//</span></span><br><span class="line">uchar TIME[<span class="number">7</span>] = &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0x12</span>, <span class="number">0x07</span>, <span class="number">0x05</span>, <span class="number">0x06</span>, <span class="number">0x16</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Ds1302Write</span><span class="params">(uchar addr, uchar dat)</span>   <span class="comment">//向DS1302命令（地址+数据）</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">       uchar n;</span><br><span class="line">       RST = <span class="number">0</span>;</span><br><span class="line">       _nop_();</span><br><span class="line"></span><br><span class="line">       SCLK = <span class="number">0</span>;   <span class="comment">//先将SCLK置低电平。</span></span><br><span class="line">       _nop_();</span><br><span class="line">       RST = <span class="number">1</span>;   <span class="comment">//然后将RST(CE)置高电平。</span></span><br><span class="line">       _nop_();</span><br><span class="line"></span><br><span class="line">       <span class="keyword">for</span> (n=<span class="number">0</span>; n&lt;<span class="number">8</span>; n++)       <span class="comment">//开始传送八位地址命令</span></span><br><span class="line">       &#123;</span><br><span class="line">       DSIO = addr &amp; <span class="number">0x01</span>;   <span class="comment">//数据从低位开始传送</span></span><br><span class="line">       addr &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">       SCLK = <span class="number">1</span>;      <span class="comment">//数据在上升沿时，DS1302读取数据</span></span><br><span class="line">       _nop_();</span><br><span class="line">       SCLK = <span class="number">0</span>;</span><br><span class="line">       _nop_();</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">for</span> (n=<span class="number">0</span>; n&lt;<span class="number">8</span>; n++)     <span class="comment">//写入8位数据</span></span><br><span class="line">       &#123;</span><br><span class="line">       DSIO = dat &amp; <span class="number">0x01</span>;</span><br><span class="line">       dat &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">       SCLK = <span class="number">1</span>;      <span class="comment">//数据在上升沿时，DS1302读取数据</span></span><br><span class="line">       _nop_();</span><br><span class="line">       SCLK = <span class="number">0</span>;</span><br><span class="line">       _nop_();       </span><br><span class="line">       &#125;       </span><br><span class="line">        </span><br><span class="line">       RST = <span class="number">0</span>;         <span class="comment">//传送数据结束</span></span><br><span class="line">       _nop_();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">uchar <span class="title">Ds1302Read</span><span class="params">(uchar addr)</span>      <span class="comment">//读取一个地址的数据</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">       uchar n,dat,dat1;</span><br><span class="line">       RST = <span class="number">0</span>;</span><br><span class="line">       _nop_();</span><br><span class="line"></span><br><span class="line">       SCLK = <span class="number">0</span>;           <span class="comment">//先将SCLK置低电平。</span></span><br><span class="line">       _nop_();</span><br><span class="line">       RST = <span class="number">1</span>;               <span class="comment">//然后将RST(CE)置高电平。</span></span><br><span class="line">       _nop_();</span><br><span class="line"></span><br><span class="line">       <span class="keyword">for</span>(n=<span class="number">0</span>; n&lt;<span class="number">8</span>; n++)            <span class="comment">//开始传送八位地址命令</span></span><br><span class="line">       &#123;</span><br><span class="line">       DSIO = addr &amp; <span class="number">0x01</span>;       <span class="comment">//数据从低位开始传送</span></span><br><span class="line">       addr &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">       SCLK = <span class="number">1</span>;             <span class="comment">//数据在上升沿时，DS1302读取数据</span></span><br><span class="line">       _nop_();</span><br><span class="line">       SCLK = <span class="number">0</span>;             <span class="comment">//DS1302下降沿时，放置数据</span></span><br><span class="line">       _nop_();</span><br><span class="line">       &#125;</span><br><span class="line">       _nop_();</span><br><span class="line">       <span class="keyword">for</span>(n=<span class="number">0</span>; n&lt;<span class="number">8</span>; n++)              <span class="comment">//读取8位数据</span></span><br><span class="line">       &#123;</span><br><span class="line">       dat1 = DSIO;           <span class="comment">//从最低位开始接收</span></span><br><span class="line">       dat = (dat&gt;&gt;<span class="number">1</span>) | (dat1&lt;&lt;<span class="number">7</span>);</span><br><span class="line">       SCLK = <span class="number">1</span>;</span><br><span class="line">       _nop_();</span><br><span class="line">       SCLK = <span class="number">0</span>;           <span class="comment">//DS1302下降沿时，放置数据</span></span><br><span class="line">       _nop_();</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       RST = <span class="number">0</span>;</span><br><span class="line">       _nop_();              <span class="comment">//以下为DS1302复位的稳定时间,必须的。</span></span><br><span class="line">       SCLK = <span class="number">1</span>;</span><br><span class="line">       _nop_();</span><br><span class="line">       DSIO = <span class="number">0</span>;</span><br><span class="line">       _nop_();</span><br><span class="line">       DSIO = <span class="number">1</span>;</span><br><span class="line">       _nop_();</span><br><span class="line">       <span class="keyword">return</span> dat;       </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Ds1302Init</span><span class="params">()</span>         <span class="comment">//初始化DS1302</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">       uchar n;</span><br><span class="line">       Ds1302Write(<span class="number">0x8E</span>,<span class="number">0X00</span>);        <span class="comment">//禁止写保护，就是关闭写保护功能</span></span><br><span class="line">       <span class="keyword">for</span> (n=<span class="number">0</span>; n&lt;<span class="number">7</span>; n++)           <span class="comment">//写入7个字节的时钟信号：分秒时日月周年</span></span><br><span class="line">       &#123;</span><br><span class="line">       Ds1302Write(WRITE_RTC_ADDR[n],TIME[n]);       </span><br><span class="line">       &#125;</span><br><span class="line">       Ds1302Write(<span class="number">0x8E</span>,<span class="number">0x80</span>);        <span class="comment">//打开写保护功能</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Ds1302ReadTime</span><span class="params">()</span>             <span class="comment">//读取时钟信息</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">       uchar n;</span><br><span class="line">       <span class="keyword">for</span> (n=<span class="number">0</span>; n&lt;<span class="number">7</span>; n++)      <span class="comment">//读取7个字节的时钟信号：分秒时日月周年</span></span><br><span class="line">       &#123;</span><br><span class="line">       TIME[n] = Ds1302Read(READ_RTC_ADDR[n]);</span><br><span class="line">       &#125;</span><br><span class="line">       </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>头文件DS1302.h代码：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> __DS1302_H_</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __DS1302_H_</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;reg52.h&gt;     //头文件</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;intrins.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> uchar          <span class="comment">//重定义关键词</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> uchar unsigned char</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> uint </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> uint unsigned int</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">sbit DSIO=P3^<span class="number">4</span>;</span><br><span class="line">sbit RST=P3^<span class="number">5</span>;</span><br><span class="line">sbit SCLK=P3^<span class="number">6</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Ds1302Write</span><span class="params">(uchar addr, uchar dat)</span></span>;</span><br><span class="line"><span class="function">uchar <span class="title">Ds1302Read</span><span class="params">(uchar addr)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Ds1302Init</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Ds1302ReadTime</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> uchar TIME[<span class="number">7</span>];       <span class="comment">//加入全局变量</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure><blockquote><p>读写时序原理图：</p></blockquote><img src="/img/loading.gif" data-lazy-src="/%E5%88%9D%E5%AD%A6%E5%8D%95%E7%89%87%E6%9C%BA2/14.png" title="图示"><blockquote><p>DS1302寄存器和RAM：<br></p></blockquote><p>1．控制寄存器</p><table><tr><td>D7</td><td>D6</td><td>D5</td><td>D4</td><td>D3</td><td>D2</td><td>D1</td><td>D0</td></tr><tr><td>1</td><td>RAM/CK</td><td>A4</td><td>A3</td><td>A2</td><td>A1</td><td>A0</td><td>RD/W</td></tr></table><p>D7：固定为1<br><br>D6：RAM/CK位，=1片内RAM，=0日历、时钟寄存器选择位。<br><br>D5~D1：地址位，用于选择进行读写的日历、时钟寄存器或片内RAM。对日历、时钟寄存器或片内RAM的选择见表。<br><br>D0： 读写选择，=0写，=1读<br></p><blockquote><p>还有时钟日期寄存器，比较多，可以自己搜。</p></blockquote><hr></div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Dragon6879</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://cjl520.top/%E5%88%9D%E5%AD%A6%E5%8D%95%E7%89%87%E6%9C%BA2/">http://cjl520.top/%E5%88%9D%E5%AD%A6%E5%8D%95%E7%89%87%E6%9C%BA2/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://cjl520.top" target="_blank">cjl's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E8%87%AA%E5%AD%A6/">自学</a></div><div class="post_share"><div class="social-share" data-image="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/IP%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B/"><img class="prev-cover" data-lazy-src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror='onerror=null,src="/img/404.jpg"'><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">IP网络技术课程</div></div></a></div><div class="next-post pull-right"><a href="/wifi%E6%A8%A1%E5%9D%97ESP8266-01s%E5%85%A5%E9%97%A8%E2%80%94%E2%80%94%E2%80%94%E8%B0%83%E8%AF%95/"><img class="next-cover" data-lazy-src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror='onerror=null,src="/img/404.jpg"'><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">wifi模块ESP8266-01s入门———调试</div></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/wifi模块ESP8266-01s入门———调试/" title="wifi模块ESP8266-01s入门———调试"><img class="relatedPosts_cover" data-lazy-src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2020-04-30</div><div class="relatedPosts_title">wifi模块ESP8266-01s入门———调试</div></div></a></div><div class="relatedPosts_item"><a href="/初学单片机/" title="初学单片机1"><img class="relatedPosts_cover" data-lazy-src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2020-04-29</div><div class="relatedPosts_title">初学单片机1</div></div></a></div><div class="relatedPosts_item"><a href="/初学单片机的障碍/" title="初学单片机的障碍"><img class="relatedPosts_cover" data-lazy-src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2020-04-28</div><div class="relatedPosts_title">初学单片机的障碍</div></div></a></div></div></div><hr><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></article></main><footer id="footer" style="background-image:url(https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg)" data-type="photo"><div id="footer-wrap"><div class="copyright">&copy;2020 By Dragon6879</div><div class="framework-info"><span>框架 </span><a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener">Butterfly</a></div></div></footer></div><section id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font_plus" type="button" title="放大字体"><i class="fas fa-plus"></i></button><button id="font_minus" type="button" title="缩小字体"><i class="fas fa-minus"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></section><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49b1f5">hexo-generator-search</a> <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div><div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module" defer></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js" async></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    window.valine = new Valine({
      el: '#vcomment',
      appId: '7VXnTLWX85gsuMybqKDkJ8bw-gzGzoHsz',
      appKey: 'CaYTeDA5OgUg0XumN5217eYi',
      placeholder: '留下你的宝贵意见吧！',
      avatar: 'monsterid',
      meta: 'nick,mail,link'.split(','),
      pageSize: '10',
      lang: 'en',
      recordIP: false,
      serverURLs: '',
      emojiCDN: '',
      emojiMaps: "",
      enableQQ: false,
      path: window.location.pathname,
    });
    if ('nick,mail') { valine.config.requiredFields= 'nick,mail'.split(',') }
  }

  if (typeof Valine === 'function') initValine() 
  else $.getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js', initValine)
}

if ('Valine' === 'Valine' || !false) {
  if (false) loadComment(document.querySelector('#vcomment'),loadValine)
  else setTimeout(() => loadValine(), 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script src="/js/third-party/ClickShowText.js" async></script></div></body></html>